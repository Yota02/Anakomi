{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-gamepad text-primary"></i> Liste des Jeux Vidéo</h1>
    <div>
        {% if current_user %}
            <a href="{{ url_for('add_videogame') }}" class="btn btn-brand me-2">
                <i class="fas fa-plus"></i> Ajouter Jeu
            </a>
        {% endif %}
        <a href="{{ url_for('videogame_top10_users') }}" class="btn btn-outline-primary">
            <i class="fas fa-trophy"></i> Top 10 Jeux
        </a>
    </div>
</div>

<!-- Formulaire de recherche et tri -->
<div class="row mb-4">
    <div class="col-12">
        <form method="get" action="{{ url_for('videogames_list') }}">
            <div class="d-flex gap-2">
                <div class="input-group flex-grow-1">
                    <input type="search" name="q" class="form-control" placeholder="Rechercher un jeu vidéo..." value="{{ request.args.get('q', '') }}">
                    <button class="btn btn-outline-secondary" type="submit"><i class="fas fa-search"></i></button>
                </div>
                <select name="sort" class="form-select" style="max-width:220px;" onchange="this.form.submit()">
                    <option value="recent" {% if sort == 'recent' %}selected{% endif %}>Plus récent</option>
                    <option value="title_asc" {% if sort == 'title_asc' %}selected{% endif %}>Titre A → Z</option>
                    <option value="title_desc" {% if sort == 'title_desc' %}selected{% endif %}>Titre Z → A</option>
                    <option value="rating_desc" {% if sort == 'rating_desc' %}selected{% endif %}>Trier par note</option>
                </select>
            </div>
        </form>
    </div>
</div>

{% if videogames %}
    <div class="row">
        {% for game in videogames %}
        <div class="col-md-4 mb-4">
            <div class="card h-100">
                {% if game.cover_url %}
                <img src="{{ game.cover_url }}" class="card-img-top" alt="{{ game.title }}" 
                     style="height: 250px; object-fit: cover;">
                {% else %}
                <div class="card-img-top d-flex align-items-center justify-content-center bg-light" 
                     style="height: 250px;">
                    <i class="fas fa-gamepad fa-3x text-muted"></i>
                </div>
                {% endif %}
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">{{ game.title }}</h5>
                    
                    <!-- Note moyenne -->
                    {% if game.avg_rating > 0 %}
                    <div class="mb-2">
                        {% set avg = game.avg_rating %}
                        {% for i in range(1, 6) %}
                            {% if i <= avg %}
                                <i class="fas fa-star text-warning"></i>
                            {% else %}
                                <i class="far fa-star text-warning"></i>
                            {% endif %}
                        {% endfor %}
                        <small class="text-muted ms-1">{{ '%.1f'|format(avg) }}/5 · {{ game.review_count or 0 }} avis</small>
                    </div>
                    {% endif %}
                    
                    <p class="card-text text-muted" style="flex:1;">
                        {{ (game.description[:100] ~ '...') if game.description and game.description|length > 100 else (game.description or '') }}
                    </p>
                    <p class="text-muted small mb-2">
                        <i class="fas fa-gamepad"></i> {{ game.platform or '—' }} · 
                        <i class="fas fa-tags"></i> {{ game.genre or '—' }} · 
                        <i class="fas fa-calendar"></i> {{ game.year or '—' }}
                    </p>
                    <div class="mt-auto">
                        <a href="{{ url_for('videogame_detail', id=game.id) }}" class="btn btn-primary">
                            <i class="fas fa-eye"></i> Voir détails
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
{% else %}
    <div class="text-center py-5">
        <h3>Aucun jeu vidéo pour le moment</h3>
        {% if current_user %}
            <p class="text-muted">Soyez le premier à ajouter un jeu vidéo !</p>
            <a href="{{ url_for('add_videogame') }}" class="btn btn-brand mt-3">
                <i class="fas fa-plus"></i> Ajouter le premier jeu
            </a>
        {% endif %}
    </div>
{% endif %}
{% endblock %}
